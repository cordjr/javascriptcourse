{"version":3,"sources":["../../app-ee6/controllers/NegociacaoController.js"],"names":["NegociacaoController","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_listaNegociacoes","NegociacoesView","_mensagem","_ordemAtual","_service","_init","lista","then","forEach","adiciona","n","catch","texto","_agendaImportacao","intervalo","setInterval","importaNegociacoes","event","preventDefault","negociacao","_criaNegociacao","cadastra","_limpaFormulario","console","log","e","coluna","inverte","ordena","a","b","apagaTodos","esvazia","err","cb","importa","negociacoes","textoParaData","value","parseFloat","focus"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from '../models/ListaNegociacoes';\nimport {Mensagem} from '../models/Mensagem';\nimport {NegociacaoView} from '../views/NegociacaoView';\nimport {MensagemView} from '../views/MensagemView';\nimport {NegociacaoService} from '../services/NegociacaoService';\nimport {DateHelper} from '../helpers/DateHelper';\nimport {Bind} from '../helpers/Bind';\nimport {Negociacao} from '../models/Negociacao';\n\nclass NegociacaoController {\n\n\tconstructor() {\n\n\t\tlet $ = document.querySelector.bind(document);\n\t\tthis._inputData = $('#data');\n\t\tthis._inputQuantidade = $('#quantidade');\n\t\tthis._inputValor = $('#valor');\n\n\t\tthis._listaNegociacoes = new Bind(new ListaNegociacoes(), new NegociacoesView($('#negociacoesView')),\n\t\t\t'adiciona', 'esvazia', 'ordena', 'inverte');\n\t\tthis._mensagem = new Bind(new Mensagem(), new MensagemView($('#mensagemView')), \"texto\");\n\t\tthis._ordemAtual = '';\n\t\tthis._service = new NegociacaoService();\n\t\tthis._init();\n\n\t}\n\n\t_init() {\n\t\tthis._service.lista()\n\t\t\t.then(lista => lista.forEach(n => this._listaNegociacoes.adiciona(n)))\n\t\t\t.catch(err => this._mensagem.texto = \"Erro ao obter necogiações!!\");\n\t\tthis._agendaImportacao(5000);\n\n\t}\n\n\n\t_agendaImportacao(intervalo) {\n\t\tsetInterval(() => {\n\t\t\tthis.importaNegociacoes();\n\t\t\t// this._agendaImportacao(intervalo);\n\n\t\t}, intervalo);\n\n\t}\n\n\tadiciona(event) {\n\t\tevent.preventDefault();\n\t\tlet negociacao = this._criaNegociacao();\n\n\t\tthis._service\n\t\t\t.cadastra(this._criaNegociacao())\n\t\t\t.then(() => {\n\t\t\t\tthis._listaNegociacoes.adiciona(negociacao);\n\t\t\t\tthis._limpaFormulario();\n\t\t\t\tthis._mensagem.texto = \"Negociação adicionada com sucesso\"\n\t\t\t}).catch(e => {\n\t\t\t\tconsole.log(e);\n\t\t\t\tthis._mensagem.texto = \"Houve um erro ao cadastrar\";\n\n\n\t\t\t});\n\n\t\t// let dao = NegociacaoDao(con)\n\n\n\n\t\t// let service = new NegociacaoService();\n\t\t// try{\n\t\t//     let negociacao = this._criaNegociacao()\n\t\t//     let dto = {\n\t\t//         data: DateHelper.dataParaTexto(negociacao.data),\n\t\t//             quantidade:  negociacao.quantidade,\n\t\t//             valor: negociacao.valor\n\t\t//     }\n\n\t\t//      service.adiciona(dto).then(()=>\n\t\t//      {\n\t\t//         this._listaNegociacoes.adiciona(negociacao);             \n\t\t//         this._mensagem.texto = 'Negociação adicionada com sucesso';\n\t\t//      }).catch((error)=>this._mensagem.texto = \"Houve um erro no servidor\");\n\n\t\t// } catch(erro){\n\t\t//     this._mensagem.texto = erro;\n\t\t// }\n\n\n\t}\n\tordena(coluna) {\n\t\tif (coluna == this._ordemAtual) {\n\t\t\tthis._listaNegociacoes.inverte();\n\n\t\t} else {\n\t\t\tthis._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\n\t\t}\n\t\tthis._ordemAtual = coluna;\n\n\t}\n\n\tapaga() {\n\n\t\tthis._service.apagaTodos()\n\t\t\t.then(() => {\n\t\t\t\tthis._listaNegociacoes.esvazia();\n\t\t\t\tthis._mensagem.texto = \"Dados Apagados com sucesso\";\n\t\t\t}).catch(err => this._mensagem.texto = err);\n\n\t}\n\n\timportaNegociacoes(cb) {\n\t\tthis._service.importa(this._listaNegociacoes.negociacoes)\n\t\t\t.then(lista => {\n\t\t\t\tconsole.log(lista);\n\t\t\t\tlista.forEach(n => this._listaNegociacoes.adiciona(n))\n\t\t\t})\n\t\t\t.then(() => this._mensagem.texto = \"Dados importados com sucesso!\")\n\t\t\t.catch(err => this._mensagem.texto = err)\n\t\t/* \n\t\t\t\tPromise.all([\n\t\t\t\t\tthis._service.obterNegociacoesDaSemana(),\n\t\t\t\t\tthis._service.obterNegociacoesDaSemanaAnterior(),\n\t\t\t\t\tthis._service.obterNegociacoesDaSemanaRetrasada()\n\t\t\t\t]).then(negociacoes => {\n\t\t\t\t\tnegociacoes.reduce(\n\t\t\t\t\t\t(flatArray, array) => flatArray.concat(array), [])\n\t\t\t\t\t\t.filter(n=> !this._listaNegociacoes.contains(n))\n\t\t\t\t\t\t.forEach(n => this._listaNegociacoes.adiciona(n))\n\t\t\t\t\tthis._mensagem.texto = \"Negociações Obtidas com Sucesso!!\";\n\t\t\t\t})\n\t\t\t\t\t.catch((error) => this._mensagem.texto(error)); */\n\t\t/*\n        service.obterNegociacoesDaSemana((error, negociacoes) => {\n            if (error) {\n                this._mensagem.texto = \"Não foi possível obter as negociações \";\n                return;\n\n            }\n            negociacoes.forEach((n) => this._listaNegociacoes.adiciona(n));\n            this._mensagem.texto = \"Negociações obtidas com sucesso!! \";\n            service.obterNegociacoesDaSemanaAnterior((error, negociacoes) => {\n                if (error) {\n                    this._mensagem.texto = \"Não foi possível obter as negociações \";\n                    return;\n    \n                }\n                negociacoes.forEach((n) => this._listaNegociacoes.adiciona(n));\n                this._mensagem.texto = \"Negociações obtidas com sucesso!! \";\n                service.obterNegociacoesDaSemanaRetrasada((error, negociacoes) => {\n                    if (error) {\n                        this._mensagem.texto = \"Não foi possível obter as negociações \";\n                        return;\n        \n                    }\n                    negociacoes.forEach((n) => this._listaNegociacoes.adiciona(n));\n                    this._mensagem.texto = \"Negociações obtidas com sucesso!! \";        \n                })\n    \n            })\n\n        })\n        */\n\n\n\n\n\t}\n\n\t_criaNegociacao() {\n\n\t\treturn new Negociacao(\n\t\t\tDateHelper.textoParaData(this._inputData.value),\n\t\t\tparseFloat(this._inputQuantidade.value),\n\t\t\tparseFloat(this._inputValor.value));\n\t}\n\n\t_limpaFormulario() {\n\n\t\tthis._inputData.value = '';\n\t\tthis._inputQuantidade.value = 1;\n\t\tthis._inputValor.value = 0.0;\n\t\tthis._inputData.focus();\n\t}\n}"]}